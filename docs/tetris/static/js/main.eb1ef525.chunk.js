(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{18:function(t,e,i){t.exports=i(32)},26:function(t,e,i){},27:function(t,e,i){},32:function(t,e,i){"use strict";i.r(e);var o=i(0),s=i.n(o),n=i(10),r=i.n(n),a=(i(26),i(27),i(28),i(11));const l=new class extends a.a{constructor(){super("TetrisData"),this.config=void 0,this.version(1).stores({configData:"++id, name, config"}),this.config=this.table("configData")}async setConfig(t,e){const i=await this.config.get({name:t});return i?await this.config.update(i.id,{name:t,config:JSON.stringify(e)}):await this.config.put({name:t,config:JSON.stringify(e)}),!0}async getConfig(t){const e=await this.config.get({name:t});return e?JSON.parse(e.config):null}};let h=function(t){return t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Drop=2]="Drop",t[t.HardDrop=3]="HardDrop",t[t.LeftTurn=4]="LeftTurn",t[t.RightTurn=5]="RightTurn",t[t.Hold=6]="Hold",t[t.Start=7]="Start",t}({});const u={default:{axisX:0,axisY:1,buttons:[14,15,12,13,0,1,9,8]},"Wireless Controller (STANDARD GAMEPAD Vendor: 054c Product: 09cc)":{axisX:0,axisY:1,buttons:[14,15,12,13,0,1,9,8]}};class c{constructor(){this.keyFlag=void 0,this.keepFlag=void 0,this.keyConfig={ArrowUp:h.HardDrop,ArrowLeft:h.Left,ArrowRight:h.Right,ArrowDown:h.Drop,Space:h.Hold,KeyZ:h.LeftTurn,KeyX:h.RightTurn,Enter:h.Start},this.buttonName={},this.keyFlag=0,this.keepFlag=0,l.getConfig("keyConfig").then(t=>{t&&(this.keyConfig=t,this.buttonName={})})}isHardDrop(t){return this.isButtonDown(h.HardDrop,t)}isDrop(t){return this.isButtonDown(h.Drop,t)}isLeftTurn(t){return this.isButtonDown(h.LeftTurn,t)}isRightTurn(t){return this.isButtonDown(h.RightTurn,t)}isHold(t){return this.isButtonDown(h.Hold,t)}isStart(t){return this.isButtonDown(h.Start,t)}processEvent(t){let e=0;return t.key in this.keyConfig?e=1<<this.keyConfig[t.key]:t.code in this.keyConfig&&(e=1<<this.keyConfig[t.code]),!!e&&("keydown"===t.type?this.keyFlag|=e:"keyup"===t.type&&(this.keyFlag&=~e,this.keepFlag&=~e),!0)}isButtonDown(t,e){let i=(this.keyFlag&1<<t&~this.keepFlag)>0;return e&&i&&(this.keepFlag|=1<<t),i}isLeft(t){return this.isButtonDown(h.Left,t)}isRight(t){return this.isButtonDown(h.Right,t)}getButtonName(t){if(!this.buttonName[t])for(let e in this.keyConfig)if(this.keyConfig[e]===t){let i="";for(let t=0;t<e.length;t++){const o=e[t],s=o.toUpperCase();t>0&&o===s&&(i+=" "),i+=s}this.buttonName[t]=i;break}return this.buttonName[t]}getKeyConfig(){return Object.assign({},this.keyConfig)}setKeyConfig(t){this.keyConfig=t,this.buttonName={},l.setConfig("keyConfig",t).then()}checkButton(){}}class d extends c{constructor(t){super(),this.padIndex=void 0,this.lastState=void 0,this.pushed=void 0,this.axis=void 0,this.padConfig=void 0,this.id=void 0,this.pushListener=void 0,this.id=t.id,this.axis=[!1,!1,!1,!1],this.padIndex=t.index,this.lastState=[],this.pushed=[];for(let e=0;e<t.buttons.length;e++)this.lastState.push(!1),this.pushed.push(!1);this.padConfig=u[t.id]||u.default,l.getConfig(t.id).then(t=>{t&&(this.padConfig=t)})}isButtonDown(t,e){const i=this.padConfig.buttons[t];return this.pushed[i]?(e&&(this.pushed[i]=!1),!0):super.isButtonDown(t,e)}checkButton(){const t=navigator.getGamepads()[this.padIndex];if(t){let e=[!1,!1,!1,!1];if(this.padConfig.axisX<t.axes.length){let i=t.axes[this.padConfig.axisX];i<-.5?e[h.Left]=!0:i>.5&&(e[h.Right]=!0)}if(this.padConfig.axisY<t.axes.length){let i=t.axes[this.padConfig.axisY];i<-.8?e[h.HardDrop]=!0:i>.5&&(e[h.Drop]=!0)}for(let t=0;t<e.length;t++)e[t]!==this.axis[t]&&(this.axis[t]=e[t],this.pushed[this.padConfig.buttons[t]]=e[t]);for(let i=0;i<t.buttons.length;i++)this.lastState[i]!==t.buttons[i].pressed&&(this.lastState[i]=t.buttons[i].pressed,this.pushed[i]=this.lastState[i],this.lastState[i]&&this.pushListener&&this.pushListener(i))}}getPadConfig(){return Object.assign({},this.padConfig)}setPadConfig(t){this.padConfig=t,l.setConfig(this.id,t).then()}resetPad(){for(let t=0;t<this.pushed.length;t++)this.pushed[t]=!1}}const f="\n// xyz, a=\u8272\u306e\u660e\u308b\u3055\nattribute vec4 a_pos;\n\nuniform vec3 u_pos;\nuniform vec2 u_size;\nuniform vec4 u_color;\nvarying vec4 v_color;\n\nvoid main() {\n    vec2 addpos = u_pos.xy + u_size.xy / 2.0;\n    gl_Position = vec4(a_pos.x * u_size.x + addpos.x, -(a_pos.y * u_size.y) / 2.0 - addpos.y, a_pos.z + u_pos.z, 1.0);\n    v_color = vec4(u_color.rgb * a_pos.a, u_color.a);\n}\n",g="\nprecision mediump float;\n\nvarying vec4 v_color;\n\nvoid main() {\n    gl_FragColor = v_color;\n}\n",m=[3135,1030,219,143,230,237,253,5121,255,231],p=[247,4751,57,4623,249,241,189,246,4617,30,9328,56,1334,8502,63,243,8255,8435,397,4609,62,3120,10294,11520,5376,3081],v=[49152,65536];class b{constructor(t){this.program=void 0,this.aPos=void 0,this.uColor=void 0,this.uPos=void 0,this.uSize=void 0,this.posVbo=void 0,this.segmentData=void 0,this.frameData=void 0;let e=t.createShader(t.VERTEX_SHADER);t.shaderSource(e,f),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)||console.log(t.getShaderInfoLog(e));let i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,g),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)||console.log(t.getShaderInfoLog(i)),this.program=t.createProgram(),t.attachShader(this.program,e),t.attachShader(this.program,i),t.linkProgram(this.program),t.useProgram(this.program),this.aPos=t.getAttribLocation(this.program,"a_pos"),this.uColor=t.getUniformLocation(this.program,"u_color"),this.uPos=t.getUniformLocation(this.program,"u_pos"),this.uSize=t.getUniformLocation(this.program,"u_size"),this.posVbo=t.createBuffer();const o=[this.makePolygon([.4,-.95],[-.4,-.95]),this.makePolygon([.4,-.9],[.4,-.05]),this.makePolygon([.4,.05],[.4,.9]),this.makePolygon([-.4,.95],[.4,.95]),this.makePolygon([-.4,.05],[-.4,.9]),this.makePolygon([-.4,-.9],[-.4,-.05]),this.makePolygon([-.4,0],[-.01,0]),this.makePolygon([.01,0],[.4,0]),this.makePolygon([-.4,-.9],[-.05,-.05]),this.makePolygon([0,-.9],[0,-.05]),this.makePolygon([.4,-.9],[.05,-.05]),this.makePolygon([-.05,.05],[-.4,.9]),this.makePolygon([0,.05],[0,.9]),this.makePolygon([.05,.05],[.4,.9]),[0,-.4,-.2,1,0,-.6,-.1,1.1,-.2,-.4,-.1,1.2,0,-.2,-.1,.8,.2,-.4,-.1,.9,0,-.6,-.1,1.1],[0,.4,-.2,1,0,.2,-.1,1.1,-.2,.4,-.1,1.2,0,.6,-.1,.8,.2,.4,-.1,.9,0,.2,-.1,1.1],[-.2,.8,-.2,1,-.2,.6,-.1,1.1,-.4,.8,-.1,1.2,-.2,1,-.1,.8,0,.8,-.1,.9,-.2,.6,-.1,1.1]];let s=0;this.segmentData=[];for(let r of o)this.segmentData.push([s,r.length/4]),s+=r.length/4;const n=[-.5,-1,-.05,1,-.5,1,-.05,.8,.5,-1,-.05,.9,.5,1,-.05,.7,-.51,-1.02,-.1,1,-.49,-.98,-.11,1.1,.51,-1.02,-.1,.9,.49,-.98,-.11,1,.51,1.02,-.1,.7,.49,.98,-.11,.8,-.51,1.02,-.1,.8,-.49,.98,-.11,.9,-.51,-1.02,-.1,1,-.49,-.98,-.11,1.1];this.frameData=[s,4,s+4,n.length/4-4],o.push(n),t.bindBuffer(t.ARRAY_BUFFER,this.posVbo),t.bufferData(t.ARRAY_BUFFER,new Float32Array(o.flat()),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null)}makePolygon(t,e){const i=e[1]-t[1],o=e[0]-t[0],s=Math.atan2(i,o),n=5*Math.PI/16,r=.15,a=Math.cos(s-n)*r,l=Math.sin(s-n)*r,h=Math.cos(s+n)*r,u=Math.sin(s+n)*r,c=Math.cos(s+Math.PI+n)*r,d=Math.sin(s+Math.PI+n)*r,f=Math.cos(s+Math.PI-n)*r,g=Math.sin(s+Math.PI-n)*r;return[(t[0]+e[0])/2,(t[1]+e[1])/2,-.1,1,t[0],t[1],0,1.1,t[0]+h,t[1]+u,0,1.2,e[0]+f,e[1]+g,0,1,e[0],e[1],0,.9,e[0]+c,e[1]+d,0,.8,t[0]+a,t[1]+l,0,.9,t[0],t[1],0,1.1]}triangleStrip(t,e){let i=[],o=[];for(let n=0;n<t.length;n++)o.push(t[n]),o.length>3&&o.splice(0,1),3===o.length&&(1&n?i.push(...o[0],...o[2],...o[1]):i.push(...o[0],...o[1],...o[2]));let s=[];for(let n=0;n<i.length;n+=3)s.push(i[n],i[n+1],i[n+2]),n<9?s.push(e[1]):(i.length,s.push(e[1]));return s}draw(t,e,i,o){3===o.length&&(o=[...o,1]);let s=i[2]/e.length,n=i[0];t.useProgram(this.program),t.enable(t.DEPTH_TEST),t.bindBuffer(t.ARRAY_BUFFER,this.posVbo),t.enableVertexAttribArray(this.aPos),t.vertexAttribPointer(this.aPos,4,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,null);for(let r=0;r<e.length;r++){let a=e.toUpperCase().charCodeAt(r),l=0;if(a>=48&&a<58?l=m[a-48]:a>=65&&a-65<p.length?l=p[a-65]:a===":".charCodeAt(0)?l=v[0]:a===".".charCodeAt(0)&&(l=v[1]),l>0)for(let e=0;e<this.segmentData.length;e++)if(l&1<<e){const r=s/20,a=i[3]/20;t.uniform3f(this.uPos,n,i[1],-.5),t.uniform2f(this.uSize,s-r,i[3]),t.uniform4fv(this.uColor,o),t.drawArrays(t.TRIANGLE_FAN,this.segmentData[e][0],this.segmentData[e][1]),t.uniform3f(this.uPos,n+r,i[1]+a,-.3),t.uniform2f(this.uSize,s-r,i[3]),t.uniform4fv(this.uColor,[0,0,0,o[3]]),t.drawArrays(t.TRIANGLE_FAN,this.segmentData[e][0],this.segmentData[e][1])}n+=s}}init(t){t.useProgram(this.program)}drawFrame(t,e,i,o){t.useProgram(this.program),t.bindBuffer(t.ARRAY_BUFFER,this.posVbo),t.enableVertexAttribArray(this.aPos),t.vertexAttribPointer(this.aPos,4,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,null),t.uniform3f(this.uPos,e[0],e[1],0),t.uniform2f(this.uSize,e[2],e[3]),o&&(3===o.length&&(o=[...o,1]),t.uniform4fv(this.uColor,o),t.drawArrays(t.TRIANGLE_STRIP,this.frameData[2],this.frameData[3])),3===i.length&&(i=[...i,1]),t.uniform4fv(this.uColor,i),t.drawArrays(t.TRIANGLE_STRIP,this.frameData[0],this.frameData[1])}}let x;function M(t){return x||(x=new b(t)),x}const L="\n// xyz, a=\u8272\u306e\u660e\u308b\u3055\nattribute vec4 a_pos;\nattribute vec3 a_normal;\n\nuniform vec3 u_blkpos;\nuniform vec4 u_color;\n\nuniform mat4 u_trans;\nuniform mat4 u_proj;\nuniform vec3 u_light;\nvarying vec4 v_color;\n\nvoid main() {\n    mat4 mvp = u_proj * u_trans;\n    gl_Position = mvp * vec4(a_pos.xyz + u_blkpos, 1.0);\n    float diffuse = dot((u_proj * vec4(a_normal, 1.0)).xyz, u_light) * 0.3 + 0.8;\n    v_color = vec4(u_color.rgb * a_pos.a * diffuse, u_color.a);\n}\n",E="\nprecision mediump float;\n\nvarying vec4 v_color;\n\nvoid main() {\n    gl_FragColor = v_color;\n}\n";function y(t,e,i){function o(t){let e=0;for(let o of t)e+=o*o;e=Math.sqrt(e);let i=[];for(let o of t)i.push(o/e);return i}function s(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function n(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}let r=o([e[0]-t[0],e[1]-t[1],e[2]-t[2]]),a=o(s(i,r)),l=s(r,a);return[a[0],l[0],-r[0],0,a[1],l[1],-r[1],0,a[2],l[2],-r[2],0,-n(a,t),-n(l,t),n(r,t),1]}class R{constructor(t){this.program=void 0,this.projection=void 0,this.translation=void 0,this.flatMvp=void 0,this.uProj=void 0,this.uTrans=void 0,this.uLight=void 0,this.aPos=void 0,this.aNormal=void 0,this.uBlkpos=void 0,this.uColor=void 0,this.posVbo=void 0,this.normalVbo=void 0;let e=t.createShader(t.VERTEX_SHADER);t.shaderSource(e,L),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS)||console.log(t.getShaderInfoLog(e));let i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,E),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)||console.log(t.getShaderInfoLog(i)),this.program=t.createProgram(),t.attachShader(this.program,e),t.attachShader(this.program,i),t.linkProgram(this.program),t.useProgram(this.program),this.projection=function(t,e,i,o){let s=1/Math.tan(t/2),n=1/(i-o);return[s/e,0,0,0,0,s,0,0,0,0,(i+o)*n,-1,0,0,i*o*n*2,0]}(.7,1,1,-1);this.translation=y([5,28,25],[5,10,0],[0,-1,0]),this.flatMvp={projection:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],translation:[1,0,0,0,0,-1,0,0,0,0,1,0,-5,10,-.2,13]},this.uProj=t.getUniformLocation(this.program,"u_proj"),this.uTrans=t.getUniformLocation(this.program,"u_trans"),this.uLight=t.getUniformLocation(this.program,"u_light"),this.aPos=t.getAttribLocation(this.program,"a_pos"),this.aNormal=t.getAttribLocation(this.program,"a_normal"),this.uBlkpos=t.getUniformLocation(this.program,"u_blkpos"),this.uColor=t.getUniformLocation(this.program,"u_color"),this.posVbo=t.createBuffer(),this.normalVbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.posVbo);const o=.05,s=.95;t.bufferData(t.ARRAY_BUFFER,new Float32Array([o,o,s,1,o,s,s,.9,s,o,s,.8,s,s,s,.6,s,o,s,.9,s,s,s,.8,s,o,o,.8,s,s,o,.7,s,s,o,1,s,s,s,.9,o,s,o,.8,o,s,s,.9,o,s,o,.9,o,s,s,.8,o,o,o,1,o,o,s,.9,-.5,20.5,1,1,-.5,20.5,0,.9,10.5,20.5,1,.9,10.5,20.5,0,.7,0,20,1,.9,0,20,0,.7,0,0,1,1,0,0,0,.8,0,0,1,1,0,0,0,.8,10,0,1,.9,10,0,0,.7,10,0,1,1,10,0,0,.9,10,20,1,.8,10,20,0,.7,10,20,1,.8,10.5,20.5,1,1,10,0,1,.8,10.5,-.5,1,1,0,0,1,.8,-.5,-.5,1,1,0,20,1,.8,-.5,20.5,1,1,10,20,1,.8,10.5,20.5,1,1,o,s,s,1,s,s,s,1,o,s,s,1,o,s,o,1,s,s,s,1,s,s,o,1,o,s,o,1,s,s,o,1,o,o,s,1,o,s,s,1,s,o,s,1,s,s,s,1,o,o,o,1,o,s,o,1,s,o,o,1,s,s,o,1,o,o,s,1,s,o,s,1,o,o,o,1,o,o,s,1,s,o,o,1,s,o,s,1,o,o,o,1,s,o,o,1,0,0,0,.8,0,20,0,1,10,0,0,.7,10,20,0,.9,1,0,0,1,1,20,0,1,2,0,0,1,2,20,0,1,3,0,0,1,3,20,0,1,4,0,0,1,4,20,0,1,5,0,0,1,5,20,0,1,6,0,0,1,6,20,0,1,7,0,0,1,7,20,0,1,8,0,0,1,8,20,0,1,9,0,0,1,9,20,0,1]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,this.normalVbo),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null)}setWeight(t,e){let i=e/5,o=5-t/50;o<1?o=1:o>9&&(o=9),this.translation=y([o,28-i,25-i/2],[5,10-i/2,0],[0,-1,0])}draw(t,e){t.useProgram(this.program),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.bindBuffer(t.ARRAY_BUFFER,this.posVbo),t.enableVertexAttribArray(this.aPos),t.vertexAttribPointer(this.aPos,4,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this.normalVbo),t.enableVertexAttribArray(this.aNormal),t.vertexAttribPointer(this.aNormal,3,t.FLOAT,!1,0,0),t.uniformMatrix4fv(this.uProj,!1,this.projection),t.uniformMatrix4fv(this.uTrans,!1,this.translation),t.uniform3f(this.uLight,0,-.8,-.6),t.uniform3f(this.uBlkpos,0,0,0),t.uniform4f(this.uColor,1,1,1,1),t.drawArrays(t.TRIANGLE_STRIP,16,26),t.uniform4f(this.uColor,0,0,.4,1),t.drawArrays(t.TRIANGLE_STRIP,66,4);for(let i of e.block)t.uniform3fv(this.uBlkpos,i.pos),t.uniform4fv(this.uColor,i.color),t.drawArrays(t.TRIANGLE_STRIP,0,16);for(let i of e.shadow)t.uniform3fv(this.uBlkpos,i.pos),t.uniform4fv(this.uColor,i.color),t.drawArrays(t.LINES,42,24);t.uniform3f(this.uLight,.4,.4,.8),t.uniformMatrix4fv(this.uProj,!1,this.flatMvp.projection),t.uniformMatrix4fv(this.uTrans,!1,this.flatMvp.translation);for(let i of e.next)t.uniform3fv(this.uBlkpos,i.pos),t.uniform4fv(this.uColor,i.color),t.drawArrays(t.TRIANGLE_STRIP,0,16)}}let C;const k=65536,D={I:{pattern:[3840,8738,240,17476],srs:{right:[[-2,0,1,0,-2,-1,1,2],[-1,0,2,0,-1,2,2,-1],[2,0,-1,0,2,1,-1,-2],[1,0,-2,0,1,-2,-2,1]],left:[[-1,0,2,0,-1,2,2,-1],[2,0,-1,0,2,1,-1,-2],[1,0,-2,0,1,-2,-2,1],[1,-2,0,1,0,-2,-1,1,2]]}},O:{pattern:[1632,1632,1632,1632],srs:{right:[[],[],[],[]],left:[[],[],[],[]]}},S:{pattern:[1728,1122,108,2244],srs:{right:[[-1,0,-1,1,0,0,-2,-1,-2],[1,0,1,-1,0,2,1,2],[1,0,1,1,0,-2,1,-2],[-1,0,-1,-1,0,2,-1,2]],left:[[1,0,1,1,0,-2,1,-2],[1,0,1,-1,0,2,1,2],[-1,0,-1,1,0,-2,-1,-2],[-1,0,-1,-1,0,2,-1,2]]}},Z:{pattern:[3168,612,198,1224],srs:{right:[[-1,0,-1,1,0,0,-2,-1,-2],[1,0,1,-1,0,2,1,2],[1,0,1,1,0,-2,1,-2],[-1,0,-1,-1,0,2,-1,2]],left:[[1,0,1,1,0,-2,1,-2],[1,0,1,-1,0,2,1,2],[-1,0,-1,1,0,-2,-1,-2],[-1,0,-1,-1,0,2,-1,2]]}},J:{pattern:[2272,1604,226,1100],srs:{right:[[-1,0,-1,1,0,0,-2,-1,-2],[1,0,1,-1,0,2,1,2],[1,0,1,1,0,-2,1,-2],[-1,0,-1,-1,0,2,-1,2]],left:[[1,0,1,1,0,-2,1,-2],[1,0,1,-1,0,2,1,2],[-1,0,-1,1,0,-2,-1,-2],[-1,0,-1,-1,0,2,-1,2]]}},L:{pattern:[736,1094,232,3140],srs:{right:[[-1,0,-1,1,0,0,-2,-1,-2],[1,0,1,-1,0,2,1,2],[1,0,1,1,0,-2,1,-2],[-1,0,-1,-1,0,2,-1,2]],left:[[1,0,1,1,0,-2,1,-2],[1,0,1,-1,0,2,1,2],[-1,0,-1,1,0,-2,-1,-2],[-1,0,-1,-1,0,2,-1,2]]}},T:{pattern:[1248,1124,228,1220],srs:{right:[[-1,0,-1,1,0,-1,-2],[1,0,1,-1,0,2,1,2],[1,0,0,-2,1,-2],[-1,0,-1,-1,0,2,-1,2]],left:[[1,0,1,1,1,-2],[1,0,1,-1,0,2,1,2],[-1,0,0,-2,-1,-2],[-1,0,-1,-1,0,2,-1,2]]}}};class A{constructor(){this.moveButton=0,this.moveResult=0,this.turnButton=0,this.turnResult=0,this.dropButton=0,this.dropResult=0,this.holdButton=!1,this.touchData={move:0,turn:0,drop:0,hard:!1,hold:!1},this.das=18,this.speed=3}resetTouch(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{move:!0,turn:!0,drop:!0,hard:!0,hold:!0};t.move&&(this.touchData.move=0),t.turn&&(this.touchData.turn=0),t.drop&&(this.touchData.drop=0),t.hard&&(this.touchData.hard=!1),t.hold&&(this.touchData.hold=!1)}touchMove(t){this.touchData.move+=t}touchTurn(t){this.touchData.turn+=t}touchDrop(t){this.touchData.drop+=t,this.touchData.hard=!1}touchHard(){this.touchData.hard=!0,this.touchData.drop=0}touchHold(){this.touchData.hold=!0}setDas(t){this.das=t}setRepeatSpeed(t){this.speed=t}isRight(){return this.touchData.move>0?(this.touchData.move--,!0):this.moveButton>0&&this.moveResult<this.moveButton&&(this.moveResult<this.das?this.moveResult=Math.max(this.das,this.moveButton+this.speed):this.moveResult++,!0)}isLeft(){return this.touchData.move<0?(this.touchData.move++,!0):this.moveButton<0&&this.moveResult>this.moveButton&&(this.moveResult>-this.das?this.moveResult=Math.min(-this.das,this.moveButton-this.speed):this.moveResult--,!0)}isRightTurn(){return this.touchData.turn>0?(this.touchData.turn--,!0):this.turnButton>0&&this.turnResult<=0&&(this.turnResult=1,!0)}isLeftTurn(){return this.touchData.turn<0?(this.touchData.turn++,!0):this.turnButton<0&&this.turnResult>=0&&(this.turnResult=-1,!0)}isHardDrop(){return!!this.touchData.hard||this.dropButton>0&&this.dropResult<=0&&(this.dropResult=1,!0)}isSoftDrop(){return this.touchData.drop>0?(this.touchData.drop--,!0):this.dropButton<0&&(this.dropResult=-1,!0)}isHold(){return this.touchData.hold?(this.touchData.hold=!1,!0):!!this.holdButton&&(this.holdButton=!1,!0)}stepFrame(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.moveButton<0?this.moveButton-=t:this.moveButton>0&&(this.moveButton+=t)}push(t){switch(t){case h.HardDrop:this.dropButton=1,this.dropResult=0;break;case h.Drop:this.dropButton=-1,this.dropResult=0;break;case h.Right:this.moveButton<=0&&(this.moveButton=1,this.moveResult=0);break;case h.Left:this.moveButton>=0&&(this.moveButton=-1,this.moveResult=0);break;case h.RightTurn:this.turnButton<=0&&(this.turnButton=1,this.turnResult=0);break;case h.LeftTurn:this.turnButton>=0&&(this.turnButton=-1,this.turnResult=0);break;case h.Hold:this.holdButton=!0}}release(t){switch(t){case h.HardDrop:this.dropButton>0&&(this.dropButton=0);break;case h.Drop:this.dropButton<0&&(this.dropButton=0);break;case h.Right:this.moveButton>0&&(this.moveButton=0);break;case h.Left:this.moveButton<0&&(this.moveButton=0);break;case h.RightTurn:this.turnButton>0&&(this.turnButton=0);break;case h.LeftTurn:this.turnButton<0&&(this.turnButton=0);break;case h.Hold:this.holdButton=!1}}}let S=[{level:0,nextLevel:100,config:{are:27,lineAre:27,das:16,lock:30,lineClear:40,gravidy:1024},bg:[[32,32,128],[64,64,192],[16,16,96],[48,48,160]]},{level:30,nextLevel:100,config:{gravidy:1536}},{level:35,nextLevel:100,config:{gravidy:2048}},{level:40,nextLevel:100,config:{gravidy:2560}},{level:50,nextLevel:100,config:{gravidy:3072}},{level:60,nextLevel:100,config:{gravidy:4096}},{level:70,nextLevel:100,config:{gravidy:8192}},{level:80,nextLevel:100,config:{gravidy:12288}},{level:90,nextLevel:100,config:{gravidy:16384}},{level:100,nextLevel:200,config:{gravidy:20480}},{level:120,nextLevel:200,config:{gravidy:24576}},{level:140,nextLevel:200,config:{gravidy:28672}},{level:160,nextLevel:200,config:{gravidy:32768}},{level:170,nextLevel:200,config:{gravidy:36864}},{level:200,nextLevel:300,config:{gravidy:1024}},{level:230,nextLevel:300,config:{gravidy:8192}},{level:233,nextLevel:300,config:{gravidy:24576}},{level:236,nextLevel:300,config:{gravidy:32768}},{level:239,nextLevel:300,config:{gravidy:40960}},{level:243,nextLevel:300,config:{gravidy:49152}},{level:247,nextLevel:300,config:{gravidy:57344}},{level:251,nextLevel:300,config:{gravidy:65536}},{level:300,nextLevel:400,config:{gravidy:131072}},{level:330,nextLevel:400,config:{gravidy:196608}},{level:360,nextLevel:400,config:{gravidy:262144}},{level:400,nextLevel:500,config:{gravidy:327680}},{level:420,nextLevel:500,config:{gravidy:262144}},{level:450,nextLevel:500,config:{gravidy:196608}},{level:500,nextLevel:600,config:{gravidy:1310720,das:10,lineClear:25}},{level:600,nextLevel:700,config:{lineAre:18,lineClear:16}},{level:700,nextLevel:800,config:{are:18,lineAre:14,lineClear:12}},{level:800,nextLevel:900,config:{are:14,lineAre:8,lineClear:6}},{level:900,nextLevel:999,config:{das:8,lock:17}}];class B{constructor(t){this.config=t,this.level=void 0,this.nextLevel=void 0,this.lastConfig=void 0,this.nextBg=void 0,this.lastMinos="SZSZ",this.configIndex=0,this.lastConfig={das:18,repeatSpeed:1,gravidy:2,ghost:!0,lineClear:50,invisibleCount:0,lineAre:30,are:30,resetLimit:15,lineWait:0,lock:30},this.level=0,this.nextLevel=0,this.checkConfig()}nextMino(t){let e="I";for(let i=0;i<7&&(e="ISZOTLJ".charAt(Math.floor(7*Math.random())),this.lastMinos.includes(e)||!(t>0||"O"!==e));i++);return this.lastMinos=this.lastMinos.substring(1)+e,e}getNextMino(){return this}checkConfig(){if(this.configIndex<this.config.length){if(this.level>=this.config[this.configIndex].level){const t=this.config[this.configIndex];return this.configIndex++,this.lastConfig=Object.assign({},this.lastConfig,t.config),this.nextLevel=t.nextLevel,void(t.bg&&(this.nextBg=t.bg))}}else this.level>this.nextLevel&&(this.level=this.nextLevel)}getBgColor(){let t=this.nextBg;return this.nextBg=void 0,t}onHold(){}onDrop(t){}onAttach(t,e){(this.level<this.nextLevel-1||e.length>0)&&(this.level+=e.length+1,e.length>=3&&(this.level++,e.length>=4&&this.level++)),this.checkConfig()}onNext(t){return this.lastConfig}}class P{constructor(){this.cacheMino=[]}nextMino(t){if(this.cacheMino.length<1){let t=["O","I","T","S","Z","J","L"];for(;t.length>1;){let e=Math.floor(Math.random()*t.length);this.cacheMino.push(t.splice(e,1)[0])}this.cacheMino.push(t[0])}return this.cacheMino.splice(0,1)[0]}}class w{constructor(t,e){let i,o;this.button=t,this.listener=e,this.blockData=void 0,this.holdMino=void 0,this.nextMino=[],this.curMino={dropCount:0,mino:D.I,resetCount:0,rotate:0,touchCount:0,x:3,y:20,hold:!1,block:[],lastGhost:void 0,lastPos:void 0},this.config=void 0,this.mode=void 0,this.modeCount=void 0,this.delLines=[],this.nextMinoProc=void 0,this.tetrimino=void 0,this.minoCount=0,this.insertPlay=void 0,this.overFlag=!1,this.blockData=new Uint8Array(512),this.modeCount=30,this.mode=0,this.config={das:18,repeatSpeed:3,gravidy:2,ghost:!0,lineClear:30,are:30,lineAre:30,resetLimit:15,lineWait:10,lock:20,invisibleCount:0},this.listener.getNextMino&&(i=this.listener.getNextMino()),i||(i=new P),this.nextMinoProc=i,this.listener.getTetrimino&&(o=this.listener.getTetrimino()),o||(o=D),this.tetrimino=o;let s=0;for(let n in this.tetrimino)s++,this.tetrimino[n]=Object.assign({},this.tetrimino[n],{index:s});this.makeNext()}makeNext(){if(!(this.nextMino.length>7))for(let t=0;t<7;t++)this.nextMino.push(this.tetrimino[this.nextMinoProc.nextMino(this.minoCount++)])}setCurMino(t){this.curMino={dropCount:0,mino:t,resetCount:0,rotate:0,touchCount:0,x:3,y:20,hold:!1,block:[],lastGhost:void 0,lastPos:void 0};for(let e=0;e<4;e++){let t=this.curMino.mino.pattern[e],i=[];for(let e=0;e<4;e++)for(let o=0;o<4;o++)0!==(32768&t)&&i.push(o,-e),t<<=1;this.curMino.block.push(i)}this.canMove(0,0,0)||(console.log("Game Over"),this.setInsertPlay(new _))}stepFrame(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.button.stepFrame(t);for(let e=0;e<t;e++){for(let t=0;t<20;t++){let e=this.blockData[t<<4|15];if(e>0){let i=0;for(let o=0;o<10;o++){let s=this.blockData[t<<4|o];(120&s)>0&&(2===e||80!==(120&s))&&(this.blockData[t<<4|o]=Math.max(0,s-8),i=e)}this.blockData[t<<4|15]=i}}if(this.insertPlay)this.insertPlay.onInsertFrame(this)||(this.insertPlay=void 0);else{if(0===this.mode){if(this.modeCount>0){this.modeCount--;continue}this.setCurMino(this.nextMino.splice(0,1)[0]),this.mode=1,this.makeNext();const t=this.listener.onNext(this.config);t&&(this.config=t,this.button.setDas(this.config.das),this.button.setRepeatSpeed(this.config.repeatSpeed))}if(3===this.mode){if(this.modeCount>0){this.modeCount--;continue}this.mode=4,this.modeCount=this.config.lineClear,this.listener.onAttach(this.curMino.lastPos,this.delLines)}if(4!==this.mode){if(1===this.mode||2===this.mode){if(!this.curMino.hold&&this.button.isHold()){const t=this.getTetrimino(0);this.holdMino?this.listener.onMove&&this.listener.onMove(t,this.getTetrimino(-1),h.Hold):(this.listener.onMove&&this.listener.onMove(t,{index:-1,pos:[]},h.Hold),this.holdMino=this.nextMino.splice(0,1)[0]);const e=this.curMino.mino;this.setCurMino(this.holdMino),this.holdMino=e,this.curMino.hold=!0,this.listener.onHold()}let t=!1;const e=this.getTetrimino(0);let i=h.Drop;if(this.button.isRightTurn()){if(this.canMove(0,0,1))this.curMino.rotate=this.curMino.rotate+1&3,t=!0;else{const e=this.curMino.mino.srs.right[this.curMino.rotate];for(let i=0;i<e.length;i+=2){let o=e[i],s=e[i+1];if(this.canMove(o,s,1)){this.curMino.rotate=this.curMino.rotate+1&3,this.curMino.x+=o,this.curMino.y+=s,t=!0;break}}}t&&(i=h.RightTurn)}else if(this.button.isLeftTurn()){if(this.canMove(0,0,3))this.curMino.rotate=this.curMino.rotate+3&3,t=!0;else{const e=this.curMino.mino.srs.left[this.curMino.rotate];for(let i=0;i<e.length;i+=2){let o=e[i],s=e[i+1];if(this.canMove(o,s,3)){this.curMino.rotate=this.curMino.rotate+3&3,this.curMino.x+=o,this.curMino.y+=s,t=!0;break}}}t&&(i=h.LeftTurn)}if(this.button.isRight()?this.canMove(1,0,0)&&(this.curMino.x++,t=!0,i=h.Right):this.button.isLeft()&&this.canMove(-1,0,0)&&(this.curMino.x--,t=!0,i=h.Left),t&&(this.curMino.lastGhost=void 0,this.curMino.lastPos=void 0),2===this.mode){if(!this.canMove(0,-1,0)){if(t&&this.curMino.resetCount<this.config.resetLimit&&(this.curMino.resetCount++,this.curMino.touchCount=0),!this.button.isSoftDrop()&&this.curMino.touchCount<this.config.lock){this.curMino.touchCount++;continue}const e=this.getTetrimino(0);for(let t=0;t<e.pos.length;t+=2){let i=e.pos[t],o=e.pos[t+1]<<4;this.blockData[o|i]=248|this.curMino.mino.index,this.blockData[15|o]=1,this.config.invisibleCount&&(this.blockData[o|10+(i>>1)]|=this.config.invisibleCount<<4*(1&i))}this.button.resetTouch(),this.checkDeleteLines()?(this.mode=3,this.modeCount=this.config.lineWait):(this.mode=0,this.modeCount=this.config.are,this.listener.onAttach(this.curMino.lastPos,[]));continue}this.mode=1,this.curMino.resetCount<this.config.resetLimit&&(this.curMino.touchCount=0),this.curMino.dropCount=Math.max(k-this.config.gravidy,0)}this.curMino.dropCount+=this.config.gravidy;let o=this.curMino.dropCount;for(this.button.isHardDrop()?this.curMino.dropCount+=20*k:this.button.isSoftDrop()&&(this.curMino.dropCount=Math.max(this.curMino.dropCount,k));this.curMino.dropCount>=k;){if(!this.canMove(0,-1,0)){this.curMino.dropCount=0,this.mode=2;break}this.curMino.dropCount-=k,o-=k,this.curMino.y--,this.curMino.lastPos=void 0,i=h.Drop,t=!0}t&&this.listener.onMove&&this.listener.onMove(e,this.getTetrimino(0),i),o<0&&this.listener.onDrop(Math.ceil(-o/k))}}else{if(this.modeCount>0){this.modeCount--;continue}let t=1;for(let e=this.delLines[0];e<24;e++)t<this.delLines.length&&e+t===this.delLines[t]?(t++,e--):this.blockData.set(this.blockData.subarray(e+t<<4,e+t+1<<4),e<<4);this.mode=0,this.modeCount=this.config.lineAre}}}}canMove(t,e,i){let o=this.curMino.rotate+i&3;for(let s=0;s<4;s++){let i=this.curMino.block[o][2*s]+this.curMino.x+t,n=this.curMino.block[o][2*s+1]+this.curMino.y+e;if(i<0||i>=10||n<0)return!1;if(0!==this.blockData[n<<4|i])return!1}return!0}checkDeleteLines(){this.delLines=[];for(let t=0;t<20;t++){let e=0;const i=t<<4;for(let t=0;t<10;t++)if(this.blockData[i|t]){e++;let o=this.blockData[i|10+(t>>1)]>>4*(1&t)&15;if(o>0){o--;const e=i|10+(t>>1);this.blockData[e]=this.blockData[e]&240>>4*(1&t)|o<<4*(1&t),0===o&&(this.blockData[i|t]=135&this.blockData[i|t]|56,this.blockData[15|i]=1)}}if(10===e){this.delLines.push(t);for(let e=0;e<10;e++)this.blockData[i|e]=7&this.blockData[t<<4|e]|120;this.blockData[15|i]=2}}return this.delLines.length>0}getGhost(){if(1!==this.mode&&2!==this.mode)return null;if(!this.config.ghost)return null;if(this.curMino.lastGhost)return this.curMino.lastGhost;let t=0;for(;this.canMove(0,t-1,0);)t--;let e=[];const i=this.curMino.block[this.curMino.rotate];for(let o=0;o<4;o++)e.push(this.curMino.x+i[2*o],this.curMino.y+t+i[2*o+1]);return this.curMino.lastGhost=e,e}getTetrimino(t){let e;if(t<0)e=this.holdMino;else{if(0===t){if(1!==this.mode&&2!==this.mode)return null;let t;if(this.curMino.lastPos)t=this.curMino.lastPos;else{t=[];const e=this.curMino.block[this.curMino.rotate];for(let i=0;i<4;i++)t.push(this.curMino.x+e[2*i],this.curMino.y+e[2*i+1]);this.curMino.lastPos=t}return{index:this.curMino.mino.index,pos:t}}e=this.nextMino[t-1]}if(e){let t=[],i=e.pattern[0];for(let e=0;e<4;e++)for(let o=0;o<4;o++)0!==(32768&i)&&t.push(o,-e),i<<=1;return{index:e.index,pos:t}}return null}getBlock(){return this.blockData}setInsertPlay(t){this.insertPlay=t}getInsertPlay(){return this.insertPlay}isGameOver(){return this.overFlag}setGameOver(){this.overFlag=!0}}class _{constructor(){this.lineY=0,this.timeCount=0}onInsertFrame(t){if(this.timeCount>0)return this.timeCount--,!0;if(this.lineY<20){const e=t.getBlock();for(let t=0;t<10;t++)128&e[this.lineY<<4|t]&&(e[this.lineY<<4|t]=192);this.lineY++}else t.setGameOver();return this.timeCount=12,!0}}const T=[h.Left,h.Right,h.HardDrop,h.Drop,h.LeftTurn,h.RightTurn,h.Hold],F=[[.7,.7,.7],[0,1,1],[1,1,0],[0,1,0],[1,0,0],[.2,.2,1],[1,.7,0],[1,0,1]];class N{constructor(t){this.button=void 0,this.fontRender=void 0,this.blockRender=void 0,this.playData=void 0,this.tgmListener=void 0,this.buttonState=[],this.lastWeight={horizontal:0,vertical:0},this.shadowList=[],this.breakList=[],this.nextPos=0,this.startCount=180,this.button=new A,this.fontRender=M(t),this.blockRender=function(t){return C||(C=new R(t)),C}(t),this.tgmListener=new B(S),this.playData=new w(this.button,this),this.blockRender.setWeight(0,0)}onHold(){this.tgmListener.onHold()}onDrop(t){this.tgmListener.onDrop(t)}onAttach(t,e){if(e.length>0){const t=this.playData.getBlock();for(let i=0;i<e.length;i++)for(let o=0;o<10;o++){const s=7&t[16*e[i]+o];this.breakList.push({index:s,pos:[o,19-e[i],0,0],veloc:[(o-4.5)/20,(e.length-i)/10-.5,.05,1],accel:[0,.05,0,0]})}}this.tgmListener.onAttach(t,e)}onNext(t){return this.nextPos=5,this.tgmListener.onNext(t)}getNextMino(){return this.tgmListener.getNextMino()}onMove(t,e,i){if(i==h.Hold){let i=t.pos[0],o=t.pos[1];for(let e=2;e<t.pos.length;e+=2)t.pos[e]<i&&(i=t.pos[e]),t.pos[e+1]>o&&(o=t.pos[e+1]);let s=[];for(let e=0;e<t.pos.length;e+=2)s.push(t.pos[e]-i-6,t.pos[e+1]-o+18);if(this.addShadow(t.index,t.pos,s),e.index>0){let t=[];s=[];for(let i=0;i<e.pos.length;i+=2)t.push(e.pos[i]-5,e.pos[i+1]+18),s.push(e.pos[i]+3,e.pos[i+1]+18);this.addShadow(e.index,t,s)}}else i!=h.Left&&i!=h.Right&&this.addShadow(t.index,t.pos,e.pos)}addShadow(t,e,i){const o=Math.max(Math.abs(e[0]-i[0]),Math.abs(e[1]-i[1]));for(let s=0;s<o;s+=5)for(let n=0;n<e.length;n+=2)this.shadowList.push({index:t,pos:[e[n]+(i[n]-e[n])*s/o,e[n+1]+(i[n+1]-e[n+1])*s/o,0],alpha:1-.02*(o-s-1)})}stepFrame(t,e){for(let g=0;g<this.shadowList.length;g++)this.shadowList[g].alpha-=.1,this.shadowList[g].alpha<=0&&(this.shadowList.splice(g,1),g--);for(let g=0;g<this.breakList.length;g++){let t=this.breakList[g];for(let e=0;e<4;e++)t.pos[e]+=t.veloc[e],t.veloc[e]+=t.accel[e];t.pos[1]>24&&(this.breakList.splice(g,1),g--)}let i=[e.isLeft(),e.isRight(),e.isHardDrop(),e.isDrop(),e.isLeftTurn(),e.isRightTurn(),e.isHold()];for(let g=0;g<T.length;g++)i[g]!==this.buttonState[g]&&(i[g]?this.button.push(T[g]):this.button.release(T[g]));this.buttonState=i,this.startCount>0?this.startCount--:this.playData.stepFrame(1);let o={block:[],shadow:[],next:[]};for(let g of this.breakList){let t=F[g.index];2&g.pos[3]&&(t=[1,1,1]),o.block.push({pos:[g.pos[0],g.pos[1],g.pos[2]],color:[t[0],t[1],t[2],1]})}const s=this.playData.getTetrimino(0);if(s){const t=F[s.index];for(let i=0;i<s.pos.length;i+=2)o.block.push({pos:[s.pos[i],19-s.pos[i+1],0],color:[t[0],t[1],t[2],1]});const e=this.playData.getGhost();if(e)for(let i=0;i<e.length;i+=2)o.block.push({pos:[e[i],19-e[i+1],0],color:[t[0],t[1],t[2],.4]})}for(let g of this.shadowList){const t=F[g.index];o.shadow.push({pos:[g.pos[0],19-g.pos[1],0],color:[t[0],t[1],t[2],g.alpha]})}const n=this.playData.getTetrimino(-1);if(n){const t=F[n.index];for(let e=0;e<n.pos.length;e+=2)o.next.push({pos:[n.pos[e]-6,2-n.pos[e+1],0],color:[t[0],t[1],t[2],1]})}this.nextPos>0&&(this.nextPos-=.25,this.nextPos<0&&(this.nextPos=0));let r=3+this.nextPos,a=-2.5;for(let g=1;g<6;g++){let t=this.playData.getTetrimino(g);if(!t)break;const e=F[t.index];if(1e3!=g||s)for(let i=0;i<t.pos.length;i+=2)o.next.push({pos:[t.pos[i]+r,a-t.pos[i+1],0],color:[e[0],e[1],e[2],1]});else for(let i=0;i<t.pos.length;i+=2)o.block.push({pos:[t.pos[i]+r,a-t.pos[i+1]-1.5,0],color:[e[0],e[1],e[2],1]});(r+=5)>13&&(a+=3*(r-13)/5,r=13)}const l=this.playData.getBlock();let h=[0,0,0,0,0,0,0,0,0,0],u=0;for(let g=19;g>=0;g--)for(let t=0;t<10;t++){let e=l[16*g+t];if(128&e){u+=t-4.5,g>h[t]&&(h[t]=g);const i=(120&e)>>3;let s=1,n=F[7&e];i<10?s=i/10:i>10&&(n=[.05*i+.4,.05*i+.4,.05*i+.4]),o.block.push({pos:[t,19-g,0],color:[n[0],n[1],n[2],s]})}}let c=20;for(let g of h)g<c&&(c=g);this.lastWeight.horizontal==u&&this.lastWeight.vertical==c||(this.lastWeight.horizontal<u?(this.lastWeight.horizontal+=1,this.lastWeight.horizontal>u&&(this.lastWeight.horizontal=u)):this.lastWeight.horizontal>u&&(this.lastWeight.horizontal-=1,this.lastWeight.horizontal<u&&(this.lastWeight.horizontal=u)),this.lastWeight.vertical<c?(this.lastWeight.vertical+=.05,this.lastWeight.vertical>c&&(this.lastWeight.vertical=c)):this.lastWeight.vertical>c&&(this.lastWeight.vertical-=.05,this.lastWeight.vertical<c&&(this.lastWeight.vertical=c)),this.blockRender.setWeight(this.lastWeight.horizontal,this.lastWeight.vertical)),this.blockRender.draw(t,o),this.fontRender.draw(t,"SCORE",[-.9,-.3,.25,.05],[1,1,1]);let d=String(this.tgmListener.level).padStart(4," "),f=String(this.tgmListener.nextLevel).padStart(4," ");if(this.fontRender.draw(t,d,[-.9,-.2,.2,.05],[1,1,1]),this.fontRender.draw(t,f,[-.9,-.12,.2,.05],[1,1,1]),this.playData.isGameOver()){if(this.fontRender.draw(t,"GAME OVER",[-.5,-.1,1,.2],[1,.4,.3,1]),e.isStart(!0))return new I(t)}else if(this.startCount>0)if(this.startCount>60){const e=.3*Math.cos(this.startCount*Math.PI/20);this.fontRender.draw(t,"READY",[-.3,-.05,.6,.1],[e+.7,e+.7,1])}else this.fontRender.draw(t,"GO",[-.1,-.05,.2,.1],[1,1,1]);return this}}class I{constructor(t){this.fontRender=void 0,this.fontRender=M(t)}stepFrame(t,e){return e.isStart(!0)?new N(t):(t.clearColor(0,0,0,1),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.fontRender.drawFrame(t,[-.7,-.8,1.4,.8],[.2,.4,.2],[.9,.9,.4]),this.fontRender.draw(t,"TETRIS",[-.6,-.7,1.2,.6],[.7,.7,.7]),t.flush(),this)}}var O=i(36),H=i(49),z=i(48),U=i(45),j=i(46),W=i(47),G=i(37),Y=i(38),V=i(39),J=i(40),K=i(41),X=i(42),Z=i(43),q=i(44);const Q=[h.HardDrop,h.Left,h.Drop,h.Right,h.Start,h.Hold,h.LeftTurn,h.RightTurn],$=["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","Enter","Space","KeyZ","KeyX"];let tt={},et={};var it=()=>{const t=Object(o.useRef)(null),e=Object(o.useRef)(),i=Object(o.useRef)(),n=Object(o.useRef)(),r=Object(o.useRef)(new c),[a]=Object(o.useState)($),[h,u]=Object(o.useState)(!1),[f,g]=Object(o.useState)(-1),[m,p]=Object(o.useState)([]),[v,b]=Object(o.useState)(!1),[x,M]=Object(o.useState)(!1),L=()=>{const t=r.current.getKeyConfig();for(let e in t){const i=t[e];$[Q.indexOf(i)]=e}},E=t=>{A.current<0||t in et||(r.current.resetPad(),et[t]=Q[A.current],$[A.current]="Button "+t,A.current+1<$.length?g(A.current+1):g(-1))},y=(t,e)=>{M(t),t?((()=>{const t=r.current.getPadConfig();for(let e of Q)$[Q.indexOf(e)]="Button "+t.buttons[e]})(),r.current.pushListener=E):L(),u(!0),g(0),tt={},et={},e&&e.blur()},R=()=>{x&&r.current instanceof d&&(r.current.pushListener=void 0),u(!1)},C=t=>{console.log(t),r.current=new d(t.gamepad),b(!0)},k=t=>{console.log(t),r.current=new c,b(!1)},D=Object(o.useRef)(h),A=Object(o.useRef)(f),S=Object(o.useRef)(x);Object(o.useEffect)(()=>{D.current=h},[h]),Object(o.useEffect)(()=>{A.current=f},[f]),Object(o.useEffect)(()=>{S.current=x},[x]);const B=t=>{if(D.current){if("keydown"===t.type&&!S.current){if(A.current<0||t.code in tt)return;t.preventDefault(),tt[t.code]=A.current,$[A.current]=t.code,A.current+1<$.length?g(A.current+1):g(-1)}}else r.current.processEvent(t)&&t.preventDefault()};return Object(o.useEffect)(()=>{const o=t.current;if(!o)return;i.current=o.getContext("webgl2"),n.current=new I(i.current),l.getConfig("keyConfig").then(t=>{L(),p([...$])}),console.log("Init");const s=()=>{r.current.checkButton(),n.current=n.current.stepFrame(i.current,r.current),e.current=requestAnimationFrame(s)};return e.current=requestAnimationFrame(s),window.addEventListener("keydown",B,!1),window.addEventListener("keyup",B,!1),window.addEventListener("gamepadconnected",C),window.addEventListener("gamepaddisconnected",k),()=>{cancelAnimationFrame(e.current),console.log("Clear"),window.removeEventListener("keydown",B),window.removeEventListener("keyup",B),window.removeEventListener("gamepadconnected",C),window.removeEventListener("gamepaddisconnected",k)}},[]),s.a.createElement("div",{style:{display:"flex",padding:"1em"}},s.a.createElement("canvas",{ref:t,width:512,height:512,style:{backgroundColor:"black"}}),s.a.createElement("div",null,s.a.createElement(O.a,{striped:!0,bordered:!0,style:{marginLeft:"1em"}},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",{colSpan:2},"\u30ad\u30fc"),s.a.createElement("th",null,"\u64cd\u4f5c\u5185\u5bb9"))),s.a.createElement("tbody",null,s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(G.a,null)),s.a.createElement("td",null,m[0]),s.a.createElement("td",null,"\u30cf\u30fc\u30c9\u30c9\u30ed\u30c3\u30d7")),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(Y.a,null)),s.a.createElement("td",null,m[1]),s.a.createElement("td",null,"\u5de6\u79fb\u52d5")),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(V.a,null)),s.a.createElement("td",null,m[2]),s.a.createElement("td",null,"\u30bd\u30d5\u30c8\u30c9\u30ed\u30c3\u30d7")),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(J.a,null)),s.a.createElement("td",null,m[3]),s.a.createElement("td",null,"\u53f3\u79fb\u52d5")),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(K.a,null)),s.a.createElement("td",null,m[4]),s.a.createElement("td",null,"\u30b2\u30fc\u30e0\u958b\u59cb")),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(X.a,null)),s.a.createElement("td",null,m[5]),s.a.createElement("td",null,"\u30db\u30fc\u30eb\u30c9")),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(Z.a,null)),s.a.createElement("td",null,m[6]),s.a.createElement("td",null,"\u5de6\u56de\u8ee2")),s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(q.a,null)),s.a.createElement("td",null,m[7]),s.a.createElement("td",null,"\u53f3\u56de\u8ee2")))),s.a.createElement(H.a,{onClick:t=>y(!1,t.target)},"\u30ad\u30fc\u8a2d\u5b9a"),v&&s.a.createElement(H.a,{onClick:t=>y(!0,t.target),style:{marginLeft:"1em"}},"\u30d1\u30c3\u30c9\u8a2d\u5b9a"),s.a.createElement(z.a,{show:h,onHide:R},s.a.createElement(z.a.Header,null,s.a.createElement(z.a.Title,null,x?"\u30d1\u30c3\u30c9\u8a2d\u5b9a":"\u30ad\u30fc\u8a2d\u5b9a")),s.a.createElement(z.a.Body,null,s.a.createElement(U.a,null,s.a.createElement(j.a,null,s.a.createElement(W.a,{xs:2}),s.a.createElement(W.a,{xs:3,className:"text-center"},s.a.createElement(G.a,{size:50,className:0===f?"bg-info":""}),s.a.createElement("p",{style:{fontSize:"10px"}},a[0])),s.a.createElement(W.a,{xs:1}),s.a.createElement(W.a,{xs:3,className:"text-center"},s.a.createElement(K.a,{size:50,className:4===f?"bg-info":""}),s.a.createElement("p",{style:{fontSize:"10px"}},a[4])),s.a.createElement(W.a,{xs:3,className:"text-center"},s.a.createElement(X.a,{size:50,className:5===f?"bg-info":""}),s.a.createElement("p",{style:{fontSize:"10px"}},a[5]))),s.a.createElement(j.a,null,s.a.createElement(W.a,{xs:3,className:"text-center"},s.a.createElement(Y.a,{size:50,className:1===f?"bg-info":""}),s.a.createElement("p",{style:{fontSize:"10px"}},a[1])),s.a.createElement(W.a,{xs:1}),s.a.createElement(W.a,{xs:3,sm:3,md:3,lg:3,className:"text-center"},s.a.createElement(J.a,{size:50,className:3===f?"bg-info":""}),s.a.createElement("p",{style:{fontSize:"10px"}},a[3]))),s.a.createElement(j.a,null,s.a.createElement(W.a,{xs:2}),s.a.createElement(W.a,{xs:3,className:"text-center"},s.a.createElement(V.a,{size:50,className:2===f?"bg-info":""}),s.a.createElement("p",{style:{fontSize:"10px"}},a[2])),s.a.createElement(W.a,{xs:1}),s.a.createElement(W.a,{xs:3,className:"text-center"},s.a.createElement(Z.a,{size:50,className:6===f?"bg-info":""}),s.a.createElement("p",{style:{fontSize:"10px"}},a[6])),s.a.createElement(W.a,{xs:3,className:"text-center"},s.a.createElement(q.a,{size:50,className:7===f?"bg-info":""}),s.a.createElement("p",{style:{fontSize:"10px"}},a[7]))))),s.a.createElement(z.a.Footer,null,s.a.createElement(H.a,{disabled:f>=0,variant:"success",onClick:()=>{if(x){const t=r.current;let e=t.getPadConfig();for(let i in et)e.buttons[et[i]]=parseInt(i);t.setPadConfig(e)}else{let t={};for(let e in tt)t[e]=Q[tt[e]];r.current.setKeyConfig(t),p([...$])}u(!1)}},"\u6c7a\u5b9a"),s.a.createElement(H.a,{disabled:0===f,variant:"warning",onClick:()=>y(x)},"\u518d\u8a2d\u5b9a"),s.a.createElement(H.a,{variant:"danger",onClick:R},"\u30ad\u30e3\u30f3\u30bb\u30eb")))))};var ot=function(){return s.a.createElement("div",{className:"App"},s.a.createElement(it,null))};var st=t=>{t&&t instanceof Function&&i.e(3).then(i.bind(null,50)).then(e=>{let{getCLS:i,getFID:o,getFCP:s,getLCP:n,getTTFB:r}=e;i(t),o(t),s(t),n(t),r(t)})};r.a.createRoot(document.getElementById("root")).render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(ot,null))),st()}},[[18,1,2]]]);
//# sourceMappingURL=main.eb1ef525.chunk.js.map